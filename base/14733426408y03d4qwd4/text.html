<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Courier New'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:600; color:#333333; background-color:#ffffff;">В предлагаемой статье речь пойдет про такие инструменты виртуализации, как Vagrant и Docker.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Проблемы разработки 1С, связанные с особенностями интеграции</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Когда вы выходите за рамки 1С, у вас могут возникнуть проблемы</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Это часто происходит в случаях, когда вы уже не можете работать в рамках одной конфигурации, и у вас помимо 1С появляются еще какие-топродукты, с которыми нужно обмениватьсяданными.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Первая проблема связана с тестированием функционала</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Мы привыкли, что у нас есть cf-ник, и этого достаточно, чтобы протестировать свой продукт и запустить его в работу. Но когда появляется различная интеграция (веб-сервисы или новые http-сервисы odata), протестировать их взаимодействие с новой версией 1С бывает очень тяжело и затратно по времени. Чаще это откладывают: «лучше я потом как-нибудь новую версию платформы 1С посмотрю».</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Вторая проблема</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">, с которой мы часто встречаемся, – это, конечно же, наш «сферический конь в вакууме»: когда мы «задеплоили» наши данные на рабочий сервер, и после этого узнаем, что теперь какой-то функционал не работает. В ответ мы часто запираемся в своей «сфере» и кричим: «у нас все работает».</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Я сейчас говорю не о проблемах в базе данных, которые у программиста не воспроизводятся, а о проблемах </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">настройки сервисов на уровне операционной системы и различных особенностях интеграции</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">И третья проблема – это периодичность выпуска новых версий платформы.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Уже прошли те времена, когда мы по полгода обсуждали новую версию, потом еще два-три месяца ее настраивали, и потом, наконец-то, обновлялись на всех наших серверах. Сейчас новые версии платформы выпускаются практически беспрерывно, и многие заказчики сразу ставят нам условие, что они работают только на такой-то версии и обновляться пока что не готовы. Поэтому нам в наших решениях приходится поддерживать весь зоопарк версий платформы. Например, мы знаем, что для Бухгалтерии 3.0 должна быть установлена самая последняя версия платформы, а УТ10.3, наоборот, стабильно работаетна 8.3.4, и обновлять ее нам пока рискованно.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Чтобы полностью протестировать все наши обмены, все конфигурации</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">, попробовать, как они будут работать с новыми версиями платформы, конечно, </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">удобно использовать виртуализацию</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Виртуализация с «батарейками»</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image13714.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Виртуализация бывает разная.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно вручную создать виртуальную машину, скачать необходимый образ, запустить его, добавить там пользователя и настроить сеть.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но для того, чтобы на этой виртуальной машине заработал наш продукт, нам недостаточно одной виртуализации. Нужно установить еще какие-то программы – необходимый минимум, чтобы протестировать работу. Поэтому мы <span style=" font-weight:696;">поговорим про виртуализацию с </span>так называемыми<span style=" font-weight:696;">«батарейками</span>», когда у вас есть готовый скрипт.</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы формируете какой-то определенный <span style=" font-weight:696;">скрипт, который автоматически настраивает вашу виртуальную машину</span>.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это позволит вам <span style=" font-weight:696;">запускать</span> ее <span style=" font-weight:696;">не вручную</span>: скрипт сам создаст виртуальную машину, сеть, настройки пользователя и установит необходимые программы.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И, самое главное, такой скрипт вы <span style=" font-weight:696;">сможете использовать повторно</span>, а также передавать его другим разработчикам.</li></ul>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">DevOps со стороны программиста</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image27079.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Сейчас немного отвлечемся. Поговорим про DevOps со стороны самого программиста.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Стандартная ситуация – у нас есть сисадмин Вася, который знает всю нашу инфраструктуру, знает, как ее настраивать, и, если возникает какая-либо проблема, он ее решает. Это работает до первого отпуска, первой болезни.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого мы просим Васю описать нашу инфраструктуру. Но, хотя системный администратор, который приходит его замещать, вроде и знает, что этот сервер у нас отвечает за Web, ему все равно приходится заново «гуглить» и искать, как его настроить.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующий этап – мы просим Васю где-то записать значения настроек для нашей инфраструктуры, и теперь, когда это необходимо, мы их просто «копипастим».</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И на следующем этапе, когда у нас есть вся документация по нашей инфраструктуре, мы сможем взять и инвертировать ее в готовый рабочий скрипт, который можно просто запустить на рабочей машине и получить нужный результат.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А пляж – это та несбыточная мечта, которая у нас есть.</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Если смотреть на это со стороны программиста 1С, то у нас эта проблема также может возникнуть. Например, когда к нам в разработку приходит новый человек, мы должны ему рассказать, какое программное обеспечение необходимо поставить и как его настроить, объяснить, как это все у нас работает. Напоминаю, что речь идет про веб-сервисы, http-сервисы, про обмены с различными программами, когда все не так прозрачно (не в одной 1C-конфигурации делается).</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Vagrant</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image30828.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Для решения этой проблемы используется продукт, который называется </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Vagrant</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Если вы начнете использовать Vagrant, то вам, в основном, будут нужны всего </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">три команды</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:696;">vagrant init</span> – инициализация, </li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:696;">vagrant up</span> – запуск</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И <span style=" font-weight:696;">vagrant ssh/rdp</span> – подключение (в зависимости от сервера виртуализации вы будете использовать либо ssh, либо rdp-подключение).</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Что такое </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Vagrant file</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">? Это </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">описание той виртуальной машины, которую вы хотите получить</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Независимо от того, какого провайдера вы используете (VMWare, Hyper-V или VirtualBox), это описание будет практически везде одинаковое. В Vagrant file вы описываете, на основании какого образа операционной системы вам нужно создать виртуальную машину, какая память под нее будет выделена, какая сеть настроена, что должно быть скопировано на эту виртуальную машину для дальнейшей установки и какие скрипты нужно запустить, чтобы установить нужное вам программное окружение.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Vagrant file</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image7196.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Вот так выглядит сам </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Vagrant file. Это – DSL-инструкция, написанная на языке Ruby</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. По Vagrant file есть документация в сети.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В самом начале описывается <span style=" font-weight:696;">название образа</span>, на основании которого будет создана наша виртуальная машина. Вам не нужно будет копировать этот образ ISO вручную, он сам найдет его либо у вас на компьютере, либо на сервере vagrantbox.es, скачает, если необходимо, и развернет из него виртуальную машину.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чуть ниже прописано <span style=" font-weight:696;">пробрасывание портов</span>.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее производится <span style=" font-weight:696;">синхронизация папки</span>. В этой папке у вас должны лежать настройки сервера 1С:Предприятие, настройки технологического журнала и сама платформа 1С, легально скачанная.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Потом указываются <span style=" font-weight:696;">параметры виртуальной машины</span>. В зависимости от VirtualBox или Hyper-V вы можете указывать какие-то индивидуальные настройки.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И, наконец, запускаются <span style=" font-weight:696;">скрипты первоначальной инициализации</span>.</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Сам конфигурационный файл – один, но в зависимости от переменных окружения вы можете влиять на его поведение (на скриншоте видно, что при поиске образа виртуальной машины анализируется значение переменной окружения V8ERSION).</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Вы можете передавать этот Vagrant file другим разработчикам, даже территориально разделенным. Нет необходимости передавать им весь шаблон виртуальной машины, который, бывает, занимает 3-4 ГБ. При запуске vagrantupу них автоматически скачается весь необходимый набор программ, все само установится и запустится.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">В некотором смысле этот Vagrant file является вашим DevOps</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. И здесь он, в частности, представлен для 1С.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Если вы, например, напишете в google «vagrant logstash», то сможете найти там готовый Vagrant file для Logstash, скачать его, точно так же написать в командной строке «vagrant up», и у вас появится виртуальная машина с полностью настроенным окружением для экспериментов с Logstash.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">А для программиста 1С мы с помощью настроек Vagrant file можем получить полностью рабочий контур для различных версий 1С:Предприятия, чтобы в нем поэкспериментировать. Этот рабочий контур может включать: Postgres, сервер 1С:Предприятие, Apache версии 2.2 (которая до сих пор 2.2) и т.д. И для запуска всего этого нам нужна только одна команда – vagrant up. По ней все само поднимется, установится, запустится. Надо будет только чуть-чуть подождать.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Скрипт инициализации для Vagrant</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image3551.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">На скриншоте показан простейший bash-скрипт для Linux (в частности, для Ubuntu), который устанавливает все пакеты, необходимые для 1С-разработки.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Запуская этот скрипт, мы устанавливаем на нашу виртуальную машину все необходимые зависимости, копируем настройки технологического журнала (мы ведь говорим про разработчиков, поэтому нам нужно копировать эти настройки) и устанавливаем debug-режим сервера 1С:Предприятия. Каталог vagrant/distr/, который здесь указан – это просто папка с дистрибутивом платформы.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Есть еще один скрипт, который устанавливает Apache в случае публикации веб-сервисов и дополнительно ставит нам отладку на определенный IP-адрес, чтобы мы могли спокойно отлаживать веб-сервисы.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Это простые скрипты, в них перечислено выполнение простейших шагов.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Vagrant vs. Docker</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image32526.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Однако у Vagrant есть проблема: он работает только с полной виртуализацией, независимо от того, что мы используем (Virtual Box или Hyper-V). </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Vagrant</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">– это в любом случае полная виртуализация, включающая виртуализацию железа. Поэтому он </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">тяжелый для запуска и большой по размерам</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Кроме того, считается, что его тяжело использовать для интеграции при запуске в Production.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Поэтому я расскажу об еще одном инструменте виртуализации на базе Linux, который называется </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Docker</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Этот продукт использует паравиртуализацию, основанную на ядре Linux. По факту, Dockerвыполняет те же самые задачи и роли, что и Vagrant, только сразу в Linux, поэтому у него есть преимущество в скорости и размере. Правда, преимущество в размере при работе с 1С небольшое: другие Docker-контейнеры обычно имеют размер порядка 30-40 Мб в одном контейнере, а минимальный размер контейнера для 1С – это 1-2 Гб. Дело в том, что каталог с платформой 1С занимает довольно большой размер, и если нужно создавать несколько контейнеров для разных версий 1С (8.3.4, 8.3.6, 8.3.7), то дисковое пространство сразу же отъедается на 5-6 Гб.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Но, с другой стороны, если говорить про Vagrant, то там только на один контейнер расходуется около 5-7 Гб.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Поэтому </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Docker более удобен в размерах, но запускается только на Linux</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Особенности Docker</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image328.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">У Docker один контейнер является одним сервисом</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Если вы в виртуальной машине поднимаете сразу же несколько сервисов (сервер 1С:Предприятие, толстый клиент, Apache, Postgres), то в Docker считается, что на каждый этот сервис вы должны поднять отдельный контейнер Docker.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">К тому же у Docker </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">немного другое представление конфигурационного файла </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">(Dockerfile) для запуска контейнера. Например, как показано на скриншоте:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Первой строчкой мы создаем Docker-контейнер на базе CentOS 6-й версии;</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Потом устанавливаем для него необходимые пакеты;</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С помощью инструкции EXPOSE делаем проброс портов;</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И последней командой указываем, какая программа у нас должна будет стартовать при старте этого Docker-контейнера. В частности, здесь это – сервер 1С:Предприятие (для Apache это будет «apache start», а для Postgres – «postgres»).</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image15798.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Поскольку Docker легко стартует, легко останавливается и легко ломается, то, </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">если у нас запущено множество работающих сервисов, мы можем не знать, кто из них с кем и как взаимодействует</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Для того чтобы соединить все эти контейнеры (микросервисы) вместе так, </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">чтобы все работало правильно, используется </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">утилита </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">Docker Compose</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Вы там описываете, какие Docker контейнеры у вас должны будут запуститься, а он уже сам будет следить, запущены ли они, и перезапускать их в случае необходимости.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Выглядит это так, как показано на скриншоте: простой текстовый файл </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">docker-compose.yml, в котором описывается запуск определенных сервисов в Docker и их зависимости между собой</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">В Docker Compose есть очень удобная вещь. Допустим, когда стартует тот же Apache, мы можем указать для него, что ему надо масштабироваться на три штуки: указываем «scale 3», запускается три Apache. Естественно, для Postgres это не подходит, но для сервера 1С:Предприятия это возможно, правда, приходится бороться с некоторыми моментами (например, с настройкой кластера серверов 1С:Предприятия).</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Чем еще интересен Docker?</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Сейчас максимальная версия Apache, с которой работает 1С для веб-сервисов, – это Apache 2.2. Но, если смотреть на последние версии Ubuntu или CentOS, там уже по умолчанию используется версия Apache 2.4, и установить поверх нее более старую версию Apache для нас проблемно, неудобно. В качестве решения мы можем указать в Docker file, что нам нужен Docker-контейнер именно на базе Cent OS 6, где по умолчанию установлен Apache версии 2.2, и в результате формируется Docker-контейнер с необходимой нам версией Apache.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Преимущества виртуализации</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image12742.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Если подвести краткий итог, то</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С помощью файлов Vagrant file и небольших образов виртуальных машин мы можем организовать <span style=" font-weight:696;">единое окружение разработчика</span>.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл Vagrant file мы <span style=" font-weight:696;">можем передать другому разработчику</span>, сказать: «делаешь vagrant up, у тебя получается вся наша инфраструктура».</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разработчик нам уже не говорит: «я вроде как доделал веб-сервис, но вы добавьте константу «Тестовая функциональность», разверните на Production, мы его включим и посмотрим, заработает он или не заработает». С помощью виртуализации он может без разворачивания в Production<span style=" font-weight:696;">полностью проверить работоспособность всего контура с учетом новых требований</span>.</li>
<li style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;" style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы можем <span style=" font-weight:696;">легко </span>менять версии платформы 1С, <span style=" font-weight:696;">проверять, работает это на новой платформе 1С</span> или нет.</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Мы сейчас с вами говорили в основном про Linux, но Vagrant также может работать и на Windows. А поскольку работа в среде Windows нам тоже интересна, поговорим о том, что там можно еще использовать.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Дополнительные инструменты автоматического развертывания для Windows</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Packer-windows</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16762.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">С Windows у нас есть проблема – это, конечно же, лицензионные отчисления. Мы просто так в интернете не можем выложить образ Windows, чтобы на основании этого бокса сформировалась нужная нам виртуальная машина.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Для этого существует специальная утилита, которая называется </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">packer-windows</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Основная </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">задача этой утилиты </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">– это</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;"> создать подготовленный образ на базе Windows для Vagrant</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. В packer-windows есть определенные ссылки на сервера Microsoft, где он может сам автоматически выкачать ISO-образ Windows Server той версии, которая вам наиболее подходит (Windows Server 2008 или Windows Server 2012) – для них есть подготовленный файл ответа.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image22242.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Если не выключить автоматическое обновление пакета, то запуск подготовки всего образа занимает пару часов (пока Windows скачает этот ISO, создаст образ, сеть, пользователей, пока все сформируется). И в результате – запустили на ночь и получили готовый образ Windows с минимально необходимыми настройками для подключения к Vagrant.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Chocolatey</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image28817.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Все-таки Windows у нас основан на GUI-интерфейсах, и мы там привыкли все устанавливать вручную, а это для скриптования не очень удобно. С этим сталкиваемся не только мы, весь мир тоже «болеет» этим. И родился инструмент, который называется Chocolatey – он немного похож на пакетный менеджер для Linux. Если знаете, в Linux мы в командной строке набираем:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">apt-get install[program-name]</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">А в Chocolateyвсе то же самое, но только из командной строки Windows мы вызываем:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Choco install[program-name]</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">И здесь мы в качестве [program-name] можем указать либо git, либо sql server express – </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">пакетный менеджер Chocolatey </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">скопирует все, что нужно для установки, и установит необходимую нам программу в тихом режиме.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image24449.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Пакетов для 1С на chocolatey.org нет, потому что мы их туда выкладывать не можем, но </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">мы для своей инфраструктуры можем сами создать нужные пакеты</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Есть шаблон пакета: просто берем setup.exe, кладем в папку, и запаковываем в этот шаблон. На скриншоте показано, как выглядит установщик такого пакета – это просто код, написанный на Powershell. После этого мы можем выполнить команду</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">chocoinstall – yonecserver</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">И у вас установится сервер 1С:Предприятия или тонкий клиент – в зависимости от того, что вы пропишете в этом скрипте. Самое интересное, что все будет происходить в «тихом» режиме.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Допустим, вы с помощью утилиты packer-windows подготовили образ на базе Windows и сформировали пакет Chocolatey для 1С определенной версии (тут также поддерживается версионирование). В результате вы получаете готовый образ виртуальной машины, в котором установлен и IIS, и 1С – вам только останется либо вручную сделать публикацию 1С-овского веб-сервиса, либо написать для этого скрипт на Powershell.</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:x-large; font-weight:296; color:#000000;">Заключение</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16811.png" /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">На скриншоте – картинка «для затравки», показывающая </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">пример использования Docker для соединения с конкретной версией хранилища конфигурации</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Дело в том, что когда в Docker развернуто несколько версий хранилища 1С, для разработчика единой точкой входа является доменное имя (оно состоит из номера версии, сервера и названия репозитория).</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">В заключение хочу сказать, что </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">с 1С можно работать, используя такие технологии, как Consul, Docker</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">. Вы можете использовать Apache2.2, поднимать различные версии сервера 1С, причем без разницы, на какой ОС вы этот сервер поднимаете – эта виртуализация может быть как в Windows, так и в Linux (но в любом случае это – виртуализация). И </span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:696; color:#333333;">в результате вы получаете легкий способ тестировать различные рабочие окружения</span><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">****************</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;">Данная статья написана по итогам доклада, прочитанного на конференции INFOSTART EVENT 2015 CONNECTION 15-17 октября 2015 года.</span></p></body></html>