<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">Создаем Docker-контейнер для Linux-версии 1C. Например, чтобы беспрепятственно использовать его на любом Linux дистрибутиве и не держать при этом &quot;дремучих&quot; версий библиотек в системе.</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Наверняка каждый из вас, кто использовал 1С клиент на linux, особенно отличном от ubuntu/debian/redhat/centos сталкивался с ворохом проблем (от версии ImageMagic и &quot;странного&quot;, если не сказать грубее, использования библиотек до всевозможных &quot;блуждающих глюков&quot;, при использовании библиотек, новее, чем доисторические). В статье предлагается один из вариантов решения этих проблем, с использованием Docker. (</span><a href="http://infostart.ru/redirect.php?url=aHR0cHM6Ly9ydS53aWtpcGVkaWEub3JnL3dpa2kvRG9ja2Vy"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; text-decoration: underline; color:#428bca;">https://ru.wikipedia.org/wiki/Docker</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Полученный в результате Docker-контейнер построен на базе ubuntu 14.04, включает mscorefonts ( набор стандартных шрифтов от MS; лицензия отличается от LGPL, текст лицензии внутри архива mscorefonts.zip), патчи infinality (для &quot;правильного&quot; рендеринга шрифтов), шрифт Fira Code (хороший, моноширный шрифт для кода)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">В репозиторий добавлена light-версия Dockerfile (без тем, шрифтов, infinality, только mscorefonts), находится в директории light.</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Прежде всего устанавливаем Docker, например для Arch Linux:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">pacman -S docker</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">gpasswd -a &lt;username&gt; docker</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">systemctl enable docker</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">systemctl start docker</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Клонируем </span><a href="http://infostart.ru/redirect.php?url=aHR0cHM6Ly9naXRodWIuY29tL3BzeXJpY2Npby9kY2sxYw=="><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; text-decoration: underline; color:#428bca;">репозиторий</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> со скриптами, и открываем Dockerfile для настройки:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">git clone https://github.com/psyriccio/dck1c.git</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#5c2699; background-color:#ffffff;">cd</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;"> dck1c</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#006a00; background-color:#ffffff;"># cd ./light # если нужно взять за основу light-версию</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">nano ./Dockerfile</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Можно избавиться от этих строк (это темы оформления, чтобы докер-приложение смотрелось как родное в системе, можно заменить на свои, распаковываются в /usr/share/themes и /usr/share/icons соответственно):</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">&amp;&amp; unzip /opt/zukitwo-themes.zip -d /usr/share/themes \ </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">&amp;&amp; unzip /opt/yltra-icons.zip -d /usr/share/icons \ </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">&amp;&amp; unzip /opt/ultraflat-icons.zip -d /usr/share/icons \ </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">В следующих строках указываем версию и архитектуру платформы и кодировку:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">ENV PLT_VERSION </span><span style=" font-family:'Consolas'; font-size:10pt; color:#1c00cf; background-color:#ffffff;">8.3</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">.</span><span style=" font-family:'Consolas'; font-size:10pt; color:#1c00cf; background-color:#ffffff;">7</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">-</span><span style=" font-family:'Consolas'; font-size:10pt; color:#1c00cf; background-color:#ffffff;">1873</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">ENV PLT_ARCH amd64 </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">ENV LANG ru_RU.utf8 </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Размещаем в директории ./distr официальные deb-пакеты, соответствующих версий и архитектуры (нужны server, common и client). Запускаем сборку контейнера коммандой:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">docker build -t psyriccio/dck1c .</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Сборка займет какое-то время. После сборки можем запускать контейнер скриптом ./run.sh или коммандой вида:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">docker run -t --rm -e DISPLAY -v </span><span style=" font-family:'Consolas'; font-size:10pt; color:#3f6e74; background-color:#ffffff;">$HOME</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">/.Xauthority:/home/user/.Xauthority -v </span><span style=" font-family:'Consolas'; font-size:10pt; color:#3f6e74; background-color:#ffffff;">$HOME</span><span style=" font-family:'Consolas'; font-size:10pt; color:#000000; background-color:#ffffff;">:/home/user -v /mnt:/mnt --net</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image163.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image13719.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image19684.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image31280.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p></body></html>