<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Courier New'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">Парсер командной строки</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Одним из способов параметризации скрипта является передача аргументов в командной строке. Традиционно, операционная система передает аргументы командной строки в виде массива строк.</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">В 1Script доступна глобальная коллекция </span><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">АргументыКоманднойСтроки</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">, в которой можно получить значения, переданные в скрипт извне.</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Понятно, что прямая обработка таких аргументов не всегда удобна, поэтому применяют библиотеки-парсеры. Библиотека </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">cmdline</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;"> является таким парсером для 1Script.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">#Использовать cmdline</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер = Новый ПарсерАргументовКоманднойСтроки();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="user-content-Концепция"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">К</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">онцепция</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">В парсер мы передаем наши ожидания - какие именно параметры мы ждем на входе. Парсер разбирает массив аргументов и возвращает нам значения в виде объекта. Если пользователь неправильно передал параметры, то парсер вернет </span><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Неопределено</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Параметры бывают двух видов:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Позиционные - сам параметр является значением. В командной строке указано непосредственное значение</li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;" style=" margin-top:16px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Именованные - сначала в командной строке указано имя, затем значение</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">myprogram c:\file.txt -action delete</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">В приведенном примере в скрипт myprogram передано 3 аргумента с точки зрения ОС. При этом, первый аргумент - позиционный, у него нет предварительной части, он сам по себе и его значение </span><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">c:\file.txt</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Далее идет </span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-style:italic; color:#333333;">именованный</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;"> параметр </span><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">-action</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;"> и его значение - </span><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">delete</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">.</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Чтобы задать данный синтаксис, мы должны настроить парсер:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьПараметр(&quot;ПутьКФайлу&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьИменованныйПараметр(&quot;-action&quot;);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Параметры = Парсер.Разобрать(АргументыКоманднойСтроки);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Сообщить(Параметры[&quot;ПутьКФайлу&quot;]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Сообщить(Параметры[&quot;-action&quot;]);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="user-content-Команды"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">К</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; font-weight:600; color:#333333;">оманды</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">В более сложных случаях скрипт может принимать на вход некие &quot;Команды&quot;, задающие режим работы. И каждая команда может иметь свой состав аргументов. Яркий пример - git. При запуске мы передаем команду и ее параметры, например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">git clone http://github.com/repo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">git commit somefile.txt -m &quot;сообщение коммита&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol'; font-size:10pt; color:#333333;">Сначала идет команда, а то, что идет за ней - зависит от самой команды.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Команда = Парсер.ОписаниеКоманды(&quot;init&quot;);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьПозиционныйПараметрКоманды(Команда, &quot;ПутьКХранилищу&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьПозиционныйПараметрКоманды(Команда, &quot;ЛокальныйКаталогГит&quot;);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьИменованныйПараметрКоманды(Команда, &quot;-email&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьИменованныйПараметрКоманды(Команда, &quot;-debug&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Парсер.ДобавитьКоманду(Команда);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#f7f7f7;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Результат = Парсер.Разобрать(АргументыКоманднойСтроки);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">Если Результат.Команда = &quot;init&quot; Тогда</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">    Параметры = Результат.ЗначенияПараметров;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">    Сообщить(Параметры[&quot;ПутьКХранилищу&quot;]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">    Сообщить(Параметры[&quot;-debug&quot;]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Consolas,Liberation Mono,Menlo,Courier,monospace'; font-size:10pt; color:#333333; background-color:#ffffff;">КонецЕсли;</span></p></body></html>