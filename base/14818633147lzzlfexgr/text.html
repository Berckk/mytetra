<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">В частности, показывается, как одним пакетным запросом найти ВСЕХ предков (потомков) в иерархическом справочнике. Аналогично можно определять входимость деталей в узлы и готовые изделия по их спецификациям, определять подмножества аналогичных запчастей по цепочке аналогов, решать другие подобные задачи. Приложен файл с примером отчета для замыкания иерархии произвольного справочника, позволяющий протестировать быстродействие запроса в разных условиях.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Несмотря на определенную «заумность» термина, транзитивное замыкание – это простое и часто встречающееся на практике понятие. Вот примеры:</span> </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#333333; background-color:#ffffff;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">Если известно, что пункт А связан с пунктом Б, а пункт Б с пунктом В, то делая вывод о том, что пункт А в итоге связан и с пунктом В, мы «транзитивно замыкаем» отношение «связанность». </span> </li>
<li style=" color:#333333; background-color:#ffffff;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">Если группа 1-1-1 входит в отдел 1-1, а тот, в свою очередь является частью департамента 1, то группа 1-1-1 также входит и в департамент 1 в результате «транзитивного замыкания» отношения «вхождение». </span> </li>
<li style=" color:#333333; background-color:#ffffff;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">Если рядовой Иванов подчиняется лейтенанту Петрову, лейтенант Петров – капитану Сидорову, капитан Сидоров – майору Пронину, майор Пронин – полковнику Хитрову, а полковник Хитров – генералу Дурову, то рядовой Иванов</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; text-decoration: line-through;">, хотя и закончил мехмат,</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;"> также подчиняется генералу Дурову в результате транзитивного замыкания отношения «подчинение».</span> </li></ol>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Получается, что когда спрашивается, как определить все группы, в которые входит некоторая номенклатура или как для каждого подразделения определить все подразделения, включенные в него иерархически, на самом деле необходимо решить одну и ту же математическую задачу: построить транзитивное замыкание соответствующих отношений.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Вопрос о том, как решать и можно ли вообще решить подобную задачу, встречается довольно часто. Можно упомянуть публикации &quot;Получение родителя верхнего уровня с помощью СКД&quot;[</span><a href="http://infostart.ru/public/84547/"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://infostart.ru/public/84547/</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">], &quot;Соединение в запросе, сравнение (В ИЕРАРХИИ)&quot;[</span><a href="http://infostart.ru/public/102086/"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://infostart.ru/public/102086/</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">], &quot;Пример получения в запросе всех подразделений с учётом иерархии (неограниченный уровень вложенности подразделений)&quot; [</span><a href="http://infostart.ru/public/117349/"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://infostart.ru/public/117349/</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">], недавнее обсуждение на форуме &quot;Запрос из справочника с выборкой подчиненных элементов&quot; [</span><a href="http://forum.infostart.ru/forum26/topic72977/message781790/#message781790"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://forum.infostart.ru/forum26/topic72977/message781790/#message781790</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">]. Решение, описываемое в статье, появилось в ходе обсуждения  &quot;Реально написать хитрый запрос&quot; [</span><a href="http://forum.infostart.ru/forum14/topic35991/message395140/#message395140"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://forum.infostart.ru/forum14/topic35991/message395140/#message395140</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">], и было там же опубликовано [(103)], однако осталось почти незамеченным. Данная публикация восполняет этот пробел. </span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Очевидная трудность решения данной задачи заключается в природе табличного представления отношений в реляционных СУБД. Допустим, отношения связанности (например) хранятся в таблице, которая имеет следующий вид:</span> </p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Пункт ... связан</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">с пунктом ...</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">1</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">2</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">2</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">3</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">3</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">4</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">...</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">...</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">99</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">100</span> </p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Тогда, чтобы определить, что пункт 1 связан с пунктом 100, потребуется выполнить множество соединений, число которых, к тому же, будет зависеть от исходных данных.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Тем не менее, решение есть. Оно довольно простое, хотя и не очевидное. Решение опирается на кое-какую математику. Вот она:</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Если</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> – матрица смежности графа исходного отношения, то ее элемент aij равен 1, если i связан с j и 0, если связи нет. Таким образом, ненулевые элементы матрицы</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> фактически отмечают существование в отношении путей длины 1,</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">2 (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> в степени 2) – путей длины 2, </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">3 – путей длины 3 и так далее. Если </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">Е</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> – единичная матрица, то</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">Е</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">)n = </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">n + … + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">3 + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">2 +</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Это специфическое биноминальное разложение представляет собой матрицу смежности графа, содержащего пути длины 0, 1, 2, 3, … , n. Здесь нет биноминальных коэффициентов, потому что операции умножения и сложения выполняются по правилам алгебры логики: 0+0=0, 0+1=1, 1+0=1, 1+1=1. Ну и поскольку в графе из N вершин нет путей длины больше N, то (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;"> +</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600; color:#333333;"> E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">)N и будет матрицей смежности транзитивного замыкания исходного отношения. <br />Во всем, что говорилось до настоящего момента, ничего нового нет. Формулы выражают общеизвестный способ, когда мы по шагам накапливаем замыкание, добавляя на каждом шаге более длинные пути. То есть, в случае отношения иерархического подчинения, сначала находим и добавляем к итоговой таблице таблицу потомков уровня 1, потом уровня 2, потом уровня 3 и так далее.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Новое заключается в том, что:</span> </p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#333333; background-color:#ffffff;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">Замечено, что если M &gt; N, где N – максимальная длина пути, то (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;"> + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)N = (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;"> + </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)M. То есть, можно не бояться возведения в степень «с запасом», которая больше, чем максимальная длина пути (глубина иерархии). Результат от этого не изменится.</span> </li>
<li style=" color:#333333; background-color:#ffffff;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">Предлагается вычислять (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">A</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)M следующим быстрым и эффективным способом: (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)2 = (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)(</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">), (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)4 = (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)2 (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)2 , (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)8 = (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)4(</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;"> А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)4, (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)16 = (</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)8( </span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">А</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">+</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; font-weight:600;">E</span><span style=" font-family:'Verdana,sans-serif'; font-size:10pt;">)8 и так далее, пока степень не станет больше требуемой.</span> </li></ol>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Если попытаться объяснить прием словами, без формул, то получится следующее:<br />На первом этапе объединяем (UNION) с исходной таблицей путей длины 1 таблицу путей длины 0 (каждый элемент связан с самим собой). Далее соединяем (JOIN) эту таблицу с собой, чтобы получить в результирующей таблице пути длины 0, 1 и 2. Снова соединяем полученную таблицу с собой и получаем в результирующей таблице пути длины 0, 1, 2, 3, 4. Уже в следующем соединении получим пути длины 0, 1, 2, 3, 4, 5, 6, 7, 8. Далее максимальная длина пути будет быстро расти и очень скоро преодолеет любой заданный предел.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">При реализации на языке 1С, получается следующая достаточно компактная функция, возвращающая в качестве результата таблицу транзитивного замыкания. Функция приведена на примере отношения иерархии групп и элементов справочника. Эту функцию можно использовать как шаблон и для других отношений. Потребуется всего лишь заменить текст в переменной «Пролог».</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">Функция </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">ТранзитивноеЗамыкание</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">ИмяСправочника</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаПути</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">) Экспорт<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Пролог </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ВЫБРАТЬ Родитель НачалоДуги, Ссылка КонецДуги ПОМЕСТИТЬ ЗамыканияДлины1 ИЗ Справочник.Номенклатура</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;"><br />            | ГДЕ Родитель &lt;&gt; Значение(Справочник.Номенклатура.ПустаяСсылка)<br /><br />            | ОБЪЕДИНИТЬ ВЫБРАТЬ Ссылка, Ссылка ИЗ Справочник.Номенклатура;&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">;<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Рефрен </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ВЫБРАТЬ РАЗЛИЧНЫЕ ПерваяДуга.НачалоДуги, ВтораяДуга.КонецДуги ПОМЕСТИТЬ ЗамыканияДлины#2 ИЗ ЗамыканияДлины#1 КАК ПерваяДуга</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;"><br />            | ВНУТРЕННЕЕ СОЕДИНЕНИЕ ЗамыканияДлины#1 КАК ВтораяДуга ПО ПерваяДуга.КонецДуги = ВтораяДуга.НачалоДуги;<br /><br />            | УНИЧТОЖИТЬ ЗамыканияДлины#1;&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">;<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Эпилог </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ВЫБРАТЬ НачалоДуги Предок, КонецДуги Потомок ИЗ ЗамыканияДлины#2 ГДЕ НачалоДуги &lt;&gt; КонецДуги&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">;<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= Новый </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">СтрЗаменить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Пролог</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;Номенклатура&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">ИмяСправочника</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">1</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">;<br /><br />    Пока </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">&lt; </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаПути </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">Цикл<br /><br />        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Текст </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Текст </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">+ </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">СтрЗаменить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">СтрЗаменить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Рефрен</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#1&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Формат</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ЧГ=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">)), </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#2&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Формат</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">2 </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">* </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ЧГ=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">2 </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">* </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;"><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">КонецЦикла;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;"><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Текст </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Текст </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">+ </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">СтрЗаменить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Эпилог</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#2&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Формат</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">МаксимальнаяДлинаЗамыканий</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;ЧГ=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />    Возврат </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Запрос</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Выполнить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">().</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Выгрузить</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">()</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">КонецФункции</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">В теле функции сначала собирается текст запроса. Он состоит из «пролога», который извлекает из базы данных исходное отношение, дополняет его путями нулевой длины и помещает результат во временную таблицу путей длины 1 и 0. Это единственная часть функции, которая зависит от структуры данных и типа исходного отношения. Далее следует «рефрен» - повторяемая часть запроса, в которой короткие пути соединяются в более длинные пути для новой временной таблицы, а также удаляется временная таблица, полученная на предыдущем шаге. Завершает текст запроса «эпилог», в котором извлекается итоговая временная таблица. После сборки полученный пакетный запрос единожды выполняется.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">На первый взгляд может показаться, что текст запроса будет очень длинным. На самом деле, даже если справочник содержит миллион элементов в цепочке подчинения (мегаматрешка!), понадобится всего двадцать рефренов. Запрос будет в десятки (сотни?) раз короче некоторых запросов в ЗиУП. </span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Второе замечание, которое можно предупредить, это то, что, возможно, потребуется отдельный запрос для определения количества элементов в справочнике, чтобы оценить максимальную длину пути (уровень подчинения). Ответом здесь будет то, что на практике почти всегда можно будет взять некоторое достаточно большое число, например 256 или 1000, исходя из характера задачи.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Третье замечание может заключаться в сомнениях: а насколько это будет быстро работать? Специально для скептиков прилагается отчет, работающий в любой конфигурации, который строит транзитивную иерархию любого справочника с замером времени выполнения запроса. Оно измеряется миллисекундами.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">Ну и, наконец, для тех, кто заметил сходство математики предлагаемого метода и &quot;Порождающего запроса&quot; [</span><a href="http://infostart.ru/public/90367/"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#428bca;">http://infostart.ru/public/90367/</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">], могу добавить, что порождающий запрос появился именно вследствие данного решения.</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:10pt; color:#333333;">P.S.: Если провести небольшой рефакторинг и перевести функцию на английский, она будет выглядеть компактней (всего 9 строк!)</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;"><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">function </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">closure</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">name</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">N</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">1</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">) export<br /><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= new </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">query</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">strreplace</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;select parent a, ref b into r1 from catalog._ where parent &lt;&gt; value(catalog._.emptyref) union select ref, ref from catalog._;&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">name</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />while </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">&lt; </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">N </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">do<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">text </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">text </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">+ </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">strreplace</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">strreplace</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;select distinct p1.a, p2.b into r#2 from r#1 as p1 join r#1 as p2 on p1.b = p2.a; drop r#1;&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#1&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">format</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;NG=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">)), </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#2&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">format</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">2 </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">* </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;NG=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />    </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">2 </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">* </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M<br /><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">enddo;<br /><br /></span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">text </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">= </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">text </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">+ </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">strreplace</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;select a Предок, b Потомок from r#2 where a &lt;&gt; b&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;#2&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">format</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">M</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#000000;">&quot;NG=0&quot;</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">));<br /><br />return </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">q</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">.</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">execute</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">().</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">unload</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">()<br /><br />endfunction</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p></body></html>