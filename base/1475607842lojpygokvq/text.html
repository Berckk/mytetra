<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Courier New'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Предисловие</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Уже около четырех лет увлекаюсь языком JS, а особенно привлекает в нем прототипная реализации объектной ориентации и замыкания. Так как я большой любитель «велотренажеров» в программировании и обожаю изучать что-то новое на практических примерах, давно хотел попробовать реализовать подобное самостоятельно, и совсем недавно шанс выпал. Одним холодным зимним днем я увлекся редактором Vim и, изучая его скриптовый язык, обратил внимание на некоторые важные особенности, а именно ассоциативные массивы и передачу функций по ссылке. Я не смог пройти мимо и реализовал свою прототипную объектную ориентацию в Vim с наследованием и полиморфностью. Хочу сразу обрадовать тех, кто не знаком с синтаксисом скриптового языка Vim, я постараюсь сопровождать код подробными комментариями. Оговорюсь, что целью этой работы было не создание полноценной объектной ориентации в Vim, а практика в реализации объектной парадигмы через прототипирование. Я, конечно, пытался сделать реализацию максимально легковесной и быстрой, но все равно сомневаюсь, что полученный результат можно эффективно применять в «боевых» скриптах, потому, прошу относиться к этому соответственно. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">С чего пришлось начать</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Для начала пара слов о том, что есть в Vim «из коробки» и что будем использовать для работы. </span><span style=" font-family:'Verdana,sans-serif'; font-weight:696; color:#000000; background-color:#ffffff;">Типизация</span><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;"> — куда же без нее, имеет 6 типов данных: Целые числа, Дробные числа, Строки, Указатель на функции, Массивы, Ассоциативные массивы. Здесь наиболее интересным для нас является последний тип. Ассоциативные массивы создаются так же, как и в JS: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Создаем «объект» и помещаем его в переменную</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Obj = {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'foo'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'bar'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">}</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">при этом в качестве значений могут выступать функции. Прекрасная основа для будущих объектов. </span><span style=" font-family:'Verdana,sans-serif'; font-weight:696; color:#000000; background-color:#ffffff;">Переменные</span><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;"> — ничего особенного, кроме важного «синтаксического сахара» — возможность обращаться к элементам ассоциативного массива через точку:  </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Выводим на экран содержимое свойства foo</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Obj.foo</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">удобно, не то слово! </span><span style=" font-family:'Verdana,sans-serif'; font-weight:696; color:#000000; background-color:#ffffff;">Функции</span><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;"> — важной особенностью является то, что можно закреплять функцию за «объектом», то есть при вызове функции из ассоциативного массива, можно получить к нему доступ через переменную self: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Obj.getFoo() dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">return</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> self.foo</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Так же не следует упускать из виду возможность добавления функций прямо в объекты. </span><span style=" font-family:'Verdana,sans-serif'; font-weight:696; color:#000000; background-color:#ffffff;">Стандартные структуры, такие как if, for и так далее</span><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;"> — какой же скриптовый язык без них?! </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Теория</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Подробно изучив возможности скриптового языка Vim (далее для сокращения буду просто писать язык Vim), принялся думать о том, что же обязательно должно быть для прототипной объектной ориентации, и вот что удумал: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Классы — а точнее прототипы, то есть некие объекты, на основании которых создаются другие объекты (экземпляры этих классов);</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Наследование — без этой прекрасной возможности, тяжело будет расширять имеющиеся классы;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Строгая типизация и полиморфность — хотелось бы, чтобы свойства будущих объектов были строго типизированы, а если свойство ожидает определенный класс, то в него можно записать и объекты дочерних классов;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пакеты, namespace и use — иначе получим захламление глобальной области видимости и необоснованное расходование памяти.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">В идеале все должно было выглядеть примерно так: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">use foo\bar\Class as Class</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Создаем класс MyClass путем наследования от Class и уточнения его свойствами foo и bar</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> MyClass = Class.expand({</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'foo'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'bar'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: Class})</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = new MyClass()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call obj.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'prop'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'val'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'prop'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call obj.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'bar'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, obj)</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Обратите внимание на процесс создания нового класса. Мы расширяем некоторый базовый класс путем дополнения его свойствами, при этом свойство foo имеет тип string, а свойство bar тип, соответствующий самому базовому классу, то есть Class. Что это должно означать на практике — в свойство foo мы можем записать с помощью метода set только строку, а в свойство bar только объект класса Class или его подклассов (в том числе и MyClass по понятным причинам). Во втором случае, если мы попытаемся записать в свойство bar объект класса MyClass, то он должен быть «ограничен» до структуры класса Class, то есть в нем не должно быть свойств foo и bar. Так же должна быть возможность вновь расширить объект до класса MyClass, но только если это необходимо (по аналогии с Java). Не будем забывать и о конструкторе, нам нужна возможность определения состояния объекта при его создании, на пример так: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = new MyClass(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'val'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">)</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Добавим сюда еще возможность определения методов и их переопределение, и получим настоящую прототипную объектную ориентацию. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Первые шаги</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Конечно на практике все не так, как в теории, многое реализовать в Vim нельзя из за особенностей языка, от чего-то пришлось отказаться из за высокой громоздкости, в результате получил следующее: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">Use D/base/Object</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Создание класса A путем расширения базового класса Object </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">let A = Object.expand('A', {'x': 1}) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Определение конструктора класса A с параметрами.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! A.new(x) dict </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = self._construct() </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  call obj.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'x'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, a:x) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">return</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Создание класса B путем расширения класса A </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">let B = A.expand('B', {'y': Object}) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Переопределение конструктора класса B с параметрами</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! B.new(x, y) dict </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = self._construct() </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Да, приходится копировать реализацию родительского класса</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  call obj.set('x', a:x) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  call obj.set('y', a:y) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  return obj </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">endfunction </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Создание объектов </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:a = A.new(2) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b = B.new(3, s:a) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'x'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; В свойстве будет храниться объект класса Object, так как свойство имеет данный тип</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">echo s:b.get('y')</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Но мы всегда можем получить более частный объект</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'y'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).instancedown(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'A'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'x'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">)</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Дело начал со следующей идеи: нужно разделить все объекты на два типа, те, которые представляют классы и содержат информацию о структуре своих экземпляров и специальные методы, такие как наследование и конструктор, и те, которые представляют объекты. Идея мне понравилась и я приступил к ее реализации, а начал с базового класса Object и двух основных методов expand и _construct: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Object = {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'class'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'Object'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">}</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Object.expand(className, properties) dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Object._construct() dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">В связи с тем, что объекты в Vim не имеют имен, нужно было как то хранить имя класса, дабы иметь возможность типизировать их свойства этими классами. Для этого было добавлено свойство class, которое хранит имя класса, а за одного отличает ассоциативные массивы Vim от моих классов (если это свойство присутствует, значит мы имеем дело с классом или его экземпляром). Метод expand принимает два параметра, имя нового класса и его свойства, и возвращает объект, представляющий новый класс, созданный на основе вызываемого класса (то есть прототипа). Метод _construct просто создает объект вызываемого класса и возвращает его. Начнем с первого метода. Алгоритм его довольно простой: создаем новый объект, добавляем в него свойство class со значением, переданным в первом параметре, дабы будущий класс имел имя; добавляем ссылку на родительский класс с помощью свойства parent; для удобства создаем ссылки в текущем объекте на все методы родительского класса; дополняем полученный объект свойствами на основе второго параметра. Последний шаг самый важный, дело в том что мы не просто копируем свойства из параметра, а создаем структуру будущего класса. В частности мы определяем тип свойства и его значение по умолчанию. </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Object.expand(className, properties) dict </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'class'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: a:className} </span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Наследование свойств. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Наследование реализуется путем формирования ссылки на родительский объект в свойстве parent. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj.parent = self </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Наследование методов. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Наследование реализуется путем формирования ссылок на методы родительского класса в одноименных методах дочернего. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">for</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> k </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">in</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> keys(self) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> t = </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">type</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">(self[k]) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Если очередной элемент это функция</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    if t == 2 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      let obj[k] = self[k] </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  endfor </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Формирование свойств. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Реализуется путем формирования структуры свойств и копирования в них значений. </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  for k in keys(a:properties) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> В качестве свойств не могут выступать элементы с именами class и parent, они уже заняты</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">if</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> k == </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'class'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> || k == </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'parent'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">      </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">continue</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> t = </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">type</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">(a:properties[k]) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Если это числа или строки, то просто копируем их</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    if t == 0 || t == 1 || t == 5 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      let obj[k] = {'value': a:properties[k], 'type': t} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Если это массивы, то копируем их рекурсивно</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    elseif t == 3 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">      </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj[k] = {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'value'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: deepcopy(a:properties[k]), </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'type'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: t} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Если это объекты, то в качестве типа указываем имя класса</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    elseif t == 4 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Если типизирует наш класс</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">      </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">if</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> has_key(a:properties[k], </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'class'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">        </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj[k] = {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'value'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'type'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: a:properties[k].class} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">      </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Если типизирует ассоциативный массив</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      elseif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        let obj[k] = {'value': a:properties[k], 'type': 4} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  endfor </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  return obj </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">endfunction</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Благодаря ссылке на родительский класс нам нет необходимости копировать все его свойства в дочерний, а отсутствие свойства parent говорит о том, что это корневой класс Object. Теперь поговорим о конструкторе. Метод _construct создает и возвращает объект на основе класса, путем копирования значений свойств класса в объект. Копировать методы не имеет смысла, так как они одинаковы для всех объектов, потому, для удобства, добавим только ссылки из объектов на методы класса: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Object._construct() dict </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = {} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Ссылка на сам класс</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  let obj.class = self </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  if has_key(self, 'parent') </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Создание объекта для родительского класса и связывание его с текущим объектом</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj.parent = self.parent._construct() </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Добавление в родительский объект ссылки на дочерний, ведь нам нужна возможность расширять объект</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    let obj.parent.child = obj </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  for property in keys(self) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    let type = type(self[property]) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    &quot;</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Создание ссылок на методы класса за исключением некоторых специальных методов, относящихся только к классам</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">if</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">type</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> == 2 &amp;&amp; property != </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'expand'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> &amp;&amp; property != </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'_construct'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> &amp;&amp; property != </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'new'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">      </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj[property] = self[property] </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">    </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">&quot; Создание свойств класса</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    elseif type == 4 &amp;&amp; has_key(self[property], 'type') </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      let propertyType = self[property].type </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      if propertyType == 0 || propertyType == 1 || propertyType == 5 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        let obj[property] = self[property].value </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      elseif propertyType == 3 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        let obj[property] = deepcopy(self[property].value) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      elseif propertyType == 4 </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        if has_key(self[property].value, 'class') </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">          let obj[property] = self[property].value._construct() </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        else </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">          let obj[property] = deepcopy(self[property].value) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">        endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">      endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">    endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  endfor </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">  return obj </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">endfunction</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Обратите внимание на то, как собирается объект по иерархии наследования. Для каждого класса создается отдельный объект (субобъект), после чего они все склеиваются в один объект ссылками. Это позволяет реализовать регрессию объектов при записи объекта в свойство с типом родительского класса, а так же делает процесс создания объекта более элегантным (копировать все свойства всех классов в объект? Фуу!) Уже сейчас проявляются некоторые свойства прототипов, а именно: все есть объект; объекты реализуются путем копирования свойств в другие объект. Другими словами прототипная объектная ориентация это простейший подход к реализации объектов в языках программирования. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Расширяемся</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">По сути, описанные методы это фундамент всей реализации. Далее нужно только добавить некоторые дополнительные методы для удобства, а именно: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">new — конструктор с параметрами;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">get — получение значения свойства;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">set — установка значения свойства с проверкой типа;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">has — имеется ли указанное свойство у объекта с учетом иерархии наследования;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instanceup — получение субобъекта вверх по иерархии наследования (регрессия);</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instancedown — получение субобъекта вниз по иерархии наследования (прогрессия);</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instanceof — принадлежит ли объект указанному классу или его подклассам.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Прежде чем описывать реализацию этих методов (думаю вы уже и сами знаете как их можно реализовать), покажу как с ними работать: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> A = Object.expand(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'A'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'a'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: 1})</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> B = Object.expand(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'B'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: A})</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Добавляем конструктору параметры</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! B.new(b) dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj = self._construct()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  obj.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, b)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">return</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> obj</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:a = A.new()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call s:a.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'a'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, 2)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b = B.new(s:a)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Получаем имя класса, экземпляром которого является объект</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.class.class </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> B</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Получаем имя класса, экземпляр которого содержится в свойстве b</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).class.class </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> A</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Записываем в свойство b объект класса B. Это возможно, так как класс B является дочерним по отношению к классу A. При этом ожидаем регрессию</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call s:b.set(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, s:b)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Так и есть, в свойстве объект класса A</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).class.class </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> A</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Но это не s:a, так как в свойстве a хранится не 2 (записанное в него ранее), а 1 (значение свойства объекта s:b)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'a'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">) </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Прогрессия возможна, так как хранящийся в свойстве b объект, на самом деле является регрессирующим объектом B</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:b.get(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'b'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).instancedown(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'B'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">).class.class </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> B</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Интересно, не правда ли? Не буду приводить подробные листинги методов, они есть на GitHub с подробными комментариями, опишу только алгоритмы работы каждого метода: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">new — зачем лишний конструктор? Дело в том, что при переопределении стандартного конструктора, в вызываемом классе не сработает механизм копирования свойств уровня этого класса, а нам это не нужно;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">get — проще некуда, если свойство имеется в данном объекте или субобъектах выше по иерархии наследования, возвращаем, иначе сообщаем об ошибке;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">set — тоже ничего сложного, проверяем тип и записываем в текущий объект или субобъекты. Важно только выявить объекты наших классов и выполнить регрессию при необходимости;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">has — тоже все довольно просто, ищем свойство в текущем объекте и субобъектах;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instanceup — поднимаемся по иерархии субобъектов с помощью свойства parent и сверяем имя класса с запрашиваемым, если найдено, возвращаем объект;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instancedown — аналогично предыдущему, только используем свойство child;</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">instanceof — вызваем instanceup и есри возвращен объект, то возвращаем true.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Use и namespace</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">К сожалению, пока реализовать толковый namespace не удалось. Пробовал по аналогии с namespace в YUI 3, но получилось не очень симпатично. Use же реализовал довольно просто: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">comm! -nargs=1 Use so </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#008080; background-color:#f8f8f8;">$HOME</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">/.vim/ftplugin/vim/&lt;args&gt;.vim</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">Определяем команду Use, которая подключает файл .vim/ftplugin/vim/адресФайла.vim, при этом каждый класс располагается отдельном файле, то есть: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">Use D/base/Object</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">это файл Object.vim расположенный в каталоге .vim/ftplugin/vim/D/base. Пример использования Дабы протестировать полученный базовый класс, реализовал класс Stack, представляющий множества с типом доступа «Стек». Ниже пример использования: </span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">if</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> exists(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'Stack'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">  finish </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endif </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">Use D/base/Object </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> Stack = Object.expand(</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'Stack'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">, {</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'_val'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: [], </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">'_index'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">: 0})</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Stack.push(el) dict </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">…</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Stack.pop() dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">…</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-weight:696; color:#333333; background-color:#f8f8f8;">function</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">! Stack.length() dict</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">…</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">endfunction</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">let</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack = Stack.new()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call s:stack.push(1)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call s:stack.push(2)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;">call s:stack.push(3)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack.length() </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> 3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack.pop() </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> 3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack.pop() </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack.pop() </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#0086b3; background-color:#f8f8f8;">echo</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> s:stack.pop() </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#dd1144; background-color:#f8f8f8;">''</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#f8f8f8;"> ERROR</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; color:#333333; background-color:#ffffff;"></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;">По моему довольно симпатично, а главное функционально. Полноценная (надеюсь) объектная ориентация на базе прототипов в Vim весом всего в 4 кило. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:medium; color:#000000; background-color:#ffffff;">Список литературы и ресурсов</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,sans-serif'; color:#000000; background-color:#ffffff;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://github.com/Bashka/DVim"><span style=" color:#990099; background-color:#000000;">Проект на GitHub</span></a></li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://rus-linux.net/MyLDP/BOOKS/Vim/prosto-o-vim.pdf"><span style=" color:#990099; background-color:#000000;">Книга «Просто о Vim»</span></a></li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://jenyay.net/Programming/VimScript1"><span style=" color:#990099; background-color:#000000;">О создании скриптов в Vim наглядно и с примерами</span></a></li></ol></body></html>