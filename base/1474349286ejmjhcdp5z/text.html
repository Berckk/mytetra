<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Courier New'; font-size:12pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; font-weight:600; color:#333333; background-color:#ffffff;">Рассказ об эффективных приемах организации обработок больших объемов данных на платформе 1С. Эти приемы можно назвать шагом к технологии big data.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="docs-internal-guid-62747c13-1822-ccf4-dc11-6217e6b0d87b"></a><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">П</span><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">риемы обработки больших данных в 1С. На пути к big data...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; color:#000000; background-color:#000000;"><br /></span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В этой статье я расскажу об эффективных приемах организации обработок больших объемов данных на платформе 1С, накопленных за годы развития и использования продукта </span><a href="http://infostart.ru/public/145983/"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">2iS:Интеграция</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">, разработанного в нашей компании </span><span style=" font-family:'Calibri'; font-weight:600; color:#000000; background-color:#000000;">2iS </span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">(ООО “ИИС” Интегрируемые Информационные Системы). Эти приемы можно назвать шагом к технологии </span><a href="http://infostart.ru/redirect.php?url=aHR0cHM6Ly9ydS53aWtpcGVkaWEub3JnL3dpa2kvJUQwJTkxJUQwJUJFJUQwJUJCJUQxJThDJUQxJTg4JUQwJUI4JUQwJUI1XyVEMCVCNCVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4QiVEMCVCNQ=="><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">big data</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-weight:600; color:#000000; background-color:#000000;">Автор статьи</span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">:  Старых Сергей (автор подсистемы </span><a href="http://infostart.ru/public/15126/"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">Инструменты разработчика</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">)<br /></span><span style=" font-family:'Calibri'; font-weight:600; color:#000000; background-color:#000000;">Редакция</span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">:  Харитонов Михаил  (автор конфигурации </span><span style=" font-family:'Calibri'; text-decoration: underline; color:#000000; background-color:#000000;">Конвертация данных</span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Термины</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Набор объектов</span> - множество объектов для обработки</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Диспетчер </span>- регламентное задание обслуживающее процессы обработок</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Примеры обработок больших данных</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Нормализация нормативно-справочной информации (объединение дублей)</span></li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Объем данных зависит от количества ссылающихся на дубли объектов</span></li>
<li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Может требовать выполнение одновременно в большом числе баз</span></li></ol>
<li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Вычисление производных от больших данных</span></li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Перезаполнение регистров при изменении первичных данных</span></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проведение большого количества документов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Заполнение новых реквизитов в больших таблицах</li></ol>
<li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Частичная очистка данных</span></li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Выявление бесполезных объектов</span></li>
<li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Удаление объектов с контролем ссылок</span></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Свертка регистров</li></ol>
<li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Выгрузка, загрузка и конвертация больших данных</span></li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Times New Roman'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Слияние (консолидация) баз, на начальном этапе требующая перекачать значительную часть данных всех баз в другую</span></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обмен большими данными вследствие других обработок больших данных</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Восстановление испорченных данных из копии базы</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Исправление испорченных данных</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Однопоточная производительность</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Для начала, рассмотрим наиболее эффективные приемы повышения однопоточной производительности для таких обработок.<br /></span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Продолжение обработки с места прерывания</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Чем дольше длится обработка, тем выше вероятность появления первой ошибки. В случае если обработка меняет условие попадания объектов в набор только в конце обработки набора объектов (например выгрузка или загрузка сообщения обмена данными), то в следующем сеансе ей приходится весь набор объектов обрабатывать заново и следовательно выполнять большое количество  бесполезных повторных вычислений. Чтобы избавиться от этих вычислений, нужно периодически запоминать текущую позицию в наборе и, в случае аварийного завершения обработки, продолжать с места последнего прерывания. Но обязательно нужно проверять, тот же самый ли набор объектов мы обрабатываем. Если набор объектов в этот раз уже другой, то нам нельзя использовать позицию предыдущего набора. Сопоставить 2 набора объектов можно вычислив  их хеши (значения хеш-функции).</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-style:italic; color:#000000; background-color:#000000;">Отсюда следует ограничение применимости приема только для воспроизводимых наборов объектов. <br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Примеры воспроизводимых наборов объектов:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">результат запроса с упорядочиванием по уникальному ключу</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">таблица значений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">файл<br /><br /></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Примеры не воспроизводимых наборов объектов:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">результат запроса без упорядочивания по уникальному ключу</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">выборка изменений по узлу плана обмена</li></ul>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Чтобы вычислить хеш любого файла в 8.3 можно использовать объект ХешированиеДанных, а в 8.2 можно использовать COM-класс </span><a href="http://infostart.ru/public/195820/"><span style=" font-family:'Calibri'; text-decoration: underline; color:#0000ff; background-color:#000000;">CAPICOM.HashedData </span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">. Чтобы получить файл из других типов наборов объектов, нужно:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Получить таблицу ключевых свойств объектов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Отсортировать таблицу по всем колонкам</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сериализовать таблицу в файл через XML</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;"><br />После вычисления хеша перед началом обработки сверяем его с тем, для которого хранится текущая позиция с прошлого сеанса обработки. Если они совпадают, то при возможности произвольного позиционирования сразу встаем на эту позицию, а при последовательном обходе объектов пропускаем все объекты набора до этой позиции.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Этот прием, например, очень эффективен при загрузке данных из большого файла.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Отключаем регламентные задания в СУБД</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="docs-internal-guid-62747c13-1bfa-7e41-86d7-ac716699fa2c"></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В</span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">ыполнение регламентных заданий в СУБД может серьезно снижать производительность обработки из-за ожиданий на блокировках и очередях аппаратных ресурсов. Поэтому их лучше временно отключать, но желательно обеспечить их автоматическое включение после завершения обработки, в т.ч. аварийного.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Оптимизация записи объекта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Минимизация ожидания на блокировках данных</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">У регистров включаем разделение итогов и после больших многопоточных обработок пересчитываем итоги в периоды минимальной нагрузки</span></li>
<li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">По возможности переводим конфигурацию на управляемые блокировки</span></li>
<li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">Используем на платформе 8.3 версионный режим MS SQL (read_committed_snapshot)</span></li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">Конфигурация должна быть в режиме управляемых блокировок</span></li>
<li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">У баз созданных на 8.3 этот режим включен по умолчанию</span></li>
<li style=" font-family:'inherit'; font-size:medium; font-weight:296; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; color:#000000;">У баз созданных на 8.2 и ниже, его нужно </span><a href="http://infostart.ru/redirect.php?url=aHR0cDovL3d3dy5naWxldi5ydS9zbmFwc2hvdDFjLw=="><span style=" font-family:'Calibri'; font-size:medium; font-weight:400; text-decoration: underline; color:#1155cc;">включать вручную</span></a></li></ul>
<li style=" font-family:'Arial'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Для анализа ожиданий на блокировках данных используем</span></li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Arial'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri';">Центр управления производительностью (ЦУП) - для управляемых блокировок и блокировок СУБД</span></li>
<li style=" font-family:'Arial'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://infostart.ru/redirect.php?url=aHR0cDovL2RldnRvb2wxYy51Y296LnJ1L2luZGV4L2FuYWxpel90ZWtobm96aHVybmFsYS8wLTE2"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc;">Анализ техножурнала</span></a><span style=" font-family:'Calibri';"> из подсистемы “</span><a href="http://infostart.ru/public/15126"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc;">Инструменты разработчика</span></a><span style=" font-family:'Calibri';">” - для управляемых блокировок</span></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://infostart.ru/redirect.php?url=aHR0cDovL3d3dy5naWxldi5ydS9sYXRjaC8="><span style=" text-decoration: underline; color:#1155cc;">Сервис анализа ожиданий на блокировках</span></a> Гилева</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Запись в режиме загрузки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Если допустимо, то используем запись в режиме загрузки (Объект.ОбменДанными.Загрузка = Истина). В этом режиме:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Методически должен выполняться очень незначительный процент кода обработчиков и подписок событий записи и потому меньше вычислений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Платформа отключает ряд своих внутренних обработчиков и потому меньше вычислений. Например:</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проверка уникальности кодов и номеров объектов</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Отключаем итоги регистров</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При возможности временно отключаем итоги регистров. Например, РегистрыНакопления.ОстаткиТоваров.УстановитьИспользованиеИтогов(Ложь)</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Оправдано для больших обработок изменения регистров</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На этот период перестанут работать виртуальные таблицы таких регистров и поэтому в частности перестанут работать многие отчеты</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Необходимо обеспечить после успешного и аварийного завершения включение итогов обратно (РегистрыНакопления.ОстаткиТоваров.УстановитьИспользованиеИтогов(Истина))</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После включения итогов обратно они пересчитываются платформой, но могут стать некорректными из-за ошибок платформы, поэтому желательно сразу после включения делать полный пересчет (РегистрыНакопления.ОстаткиТоваров.ПересчитатьИтоги())</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Отключаем авторегистрацию изменений</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При возможности отключаем авторегистрацию изменений (Объект.ОбменДанными.Получатели.АвтоЗаполнение = Ложь)</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом режиме измененный объект не будет регистрироваться платформой на всех узлах планов обмена с включенной авторегистрацией</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В распределенных базах допустимо, если обработка выполняется одновременно во всех базах и есть уверенность, что изменения объектов общих данных будут одинаковыми во всех базах</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Отключаем RLS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При возможности выполняем запись без RLS. Запросы RLS могут служить причиной серьезных потерь производительности. Варианты их отключения:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем под пользователем с набором ролей, дающим пустые RLS на нужных таблицах</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используем привилегированный режим. Варианты:</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливаем привилегированный режим (УстановитьПривилегированныйРежим(Истина))</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем код обработки из привилегированного общего модуля</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В свойствах документа устанавливаем флажки &quot;Привилегированный режим при проведении&quot; и &quot;Привилегированный режим при отмене проведения&quot;</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Устанавливаем монопольный режим</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При возможности устанавливаем монопольный режим. Чем меньше сеансов в базе, тем меньше вероятность взаимоблокировки и ожидания на блокировках данных.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливаем блокировку начала сеансов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливаем блокировку регламентных заданий</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разрываем все сеансы и соединения</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Устанавливаем монопольный режим (УстановитьМонопольныйРежим(Истина))</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Снимаем блокировку начала сеансов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Снимаем блокировку регламентных заданий</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем обработку</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После завершения сеанса обработки монопольный режим автоматически отключится</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Очищаем программный код</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В любой конфигурации может быть прикладной программный код, который обязательно выполняется при внесении изменений в БД:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">RLS</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">инициализация модулей объектов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">подписки и обработчики ПриЗаписи, ПередЗаписью, ПередУдалением</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Он может выполнять много ненужных для обработки действий (даже в режиме ОбменДанным.Загрузка) и значительно увеличивать ее длительность. Понять это можно замером производительности отладчика. Если на время обработки базу можно заблокировать для пользователей, то можно временно очистить весь программный код и таким образом избежать выполнения лишних действий во время обработки.  Алгоритм очистки:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сохраняем конфигурацию в файл</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выгружаем модули конфигурации</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очищаем полностью модули конфигурации, объектов и менеджеров</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очищаем тела всех методов общих модулей</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы обращения к ним из подписок не вызывали ошибки</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очищаем все запросы в ограничениях доступа</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загружаем модули конфигурации</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обновляем конфигурацию БД</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем обработку</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загружаем конфигурацию из файла</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обновляем конфигурацию БД</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Многопоточность</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Относительная скорость наращивания однопоточной производительности аппаратных ресурсов постоянно падает по технологическим причинам. Поэтому аппаратные ресурсы все больше растут в сторону многопоточной производительности, например растет количество ядер в процессорах. Вслед за ними адаптируются и программы. Многопоточность добавляет внутренней сложности программе, но делает ее более масштабируемой по скорости работы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Порции объектов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Чтобы набор объектов можно было многопоточно обрабатывать, его нужно как то распределить между потоками. Поэтому разбиваем набор на столько частей (порций), сколько потоков задано на старте.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; text-decoration: underline; color:#000000; background-color:#000000;">Обработка должна быть не чувствительна к порядку обработки порций</span><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;"> (обработка любой порции не зависит от успеха обработки других)</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Примеры нечувствительных к  порядку порций обработок:</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выгрузка данных</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загрузка данных</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объединение дублей (замена дублей)</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Свертка регистра</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Восстановление последовательности (документов) по разным комбинациям значений измерений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Универсальная обработка объектов</li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проведение документов, не использующих результаты проведения других документов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Заполнение реквизитов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пометка удаления</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Удаление</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Примеры чувствительных к порядку порций обработок:</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Восстановление последовательности (документов) по одной комбинации значений измерений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проведение документов, использующих результаты проведения других документов</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Подсистема</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В силу во многом одинаковой сложности, привносимой многопоточностью в логику каждой обработки, разумно вынести ее в подсистему</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Карта порций</span> – это таблица, описывающая комплект порций, на которые разбит весь набор данных для обработки</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Колонки:</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Номер </span>– условный номер порции</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Ключ </span>– произвольное примитивное значение, идентифицирующее набор данных порции</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Захватчик </span>– идентификация потока, захватившего порцию</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Номер повтора</span> – номер попытки обработки порции</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Привязка M объектов к N порциям. Распределение по порциям нужно делать как можно более равномерным, т.к. остальное время выполнения многопоточной обработки определяется  длительностью ее самого долгого потока. Но при этом следует учитывать возможные ожидания блокировки данных. Способы привязки:</li></ol>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Регистрация на служебных узлах плана обмена</span> – для объектов БД эффективный и достаточно универсальный способ для любой конфигурации.</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ключ порции – сам узел плана обмена.</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Накладные расходы = M * длительность регистрации объекта на узле (обычно в диапазоне [0.004;0.01]сек)</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Файлы порций</span> – привязка выполняется создателем файлов путем распределения объектов ним.</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ключ порции – имя файла.</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Общий файл</span> – считаем объекты с начала файла, счетчик сбрасываем каждые N объектов.</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ключ порции – значение счетчика.</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Накладные расходы = (N-1) * длительность чтения объектной структуры файла</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функции:</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Построение карты порций </span>- для набора объектов БД:</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">по результату запроса</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">по изменениям на узле плана обмена</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">по произвольному алгоритму</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Запись карты порций</span></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Захват порции </span>– помечаем порцию в карте захваченной, чтобы больше никто ее не начал обрабатывать</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Регистрация обработки порции </span>- помечаем порцию в карте обработанной</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Диспетчер обеспечивает:</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запуск дополнительных потоков обработок с захватом свободных порций и контролем числа повторов обработки каждой порции</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Освобождение порций неуспешно завершившихся потоков</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Адаптация кода обработки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Большинство обработок для корректной работы в многопоточном режиме потребуют доработки. Схема алгоритма обработки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image13656.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="https://lh4.googleusercontent.com/7ktrMiE2DYpRSPOeDnFwr6GA_Mi3VxgfrS0vrMDehqDZpe246RLXVBxNZQjGHN0mDrfFrEIrzgLcl0Pt1-OkAQmOXv1ZfC-zFQVQ4d1hLfjoyxX6tnbKyn6gAPvloS5YWWahH8A" width="-2" height="-2" style="vertical-align: middle;" /></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если номер порции не передан диспетчером, то начальные действия (однопоточно)</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очищаем старую карту порций</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Строим новую карту порций</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Записываем новую карту порций</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Захватываем порцию</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обрабатываем порцию (многопоточно)</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Получаем и обрабатываем объекты порции по ее ключу</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После успешной обработки освобождаем порцию</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Финальные действия при регистрации обработки последней порции (однопоточно)</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При необходимости выполняем слияние результатов порций</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очищаем привязки объектов к порциям</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">После регистрации обработки порции потоки не ждут друг друга, а завершаются,  сохранив при необходимости результат обработанной порции в БД или файл.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="docs-internal-guid-d2b62ef6-1be7-5c40-3fad-e1959b059b47"></a><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">М</span><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">ногопоточный обмен данными</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При переводе в многопоточный режим наиболее усложняется логика процессов передачи данных (обмена данными). На схеме ниже я попытался отразить ее основные моменты.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image8277.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Ускорение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Насколько же многопоточный режим ускорит выполнение обработки?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://infostart.ru/redirect.php?url=aHR0cHM6Ly9ydS53aWtpcGVkaWEub3JnL3dpa2kvJUQwJTk3JUQwJUIwJUQwJUJBJUQwJUJFJUQwJUJEXyVEMCU5MCVEMCVCQyVEMCVCNCVEMCVCMCVEMCVCQiVEMCVCMA=="><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">Закон Амдала</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;"> отвечает на этот вопрос достаточно скудно, т.к. не учитывает накладные расходы многопоточности. Для предложенного выше механизма нужна боле детальная формула.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В первом приближении выигрыш будет зависеть от</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">совокупной многопоточной производительности системы [Вычислительный узел клиента 1С (при наличии) - Вычислительный узел сервера 1С - Вычислительный узел сервера СУБД] в текущей ситуации. Для ее оценки можно использовать <a href="http://infostart.ru/public/173394/"><span style=" text-decoration: underline; color:#1155cc;">Многопоточное тестирование производительности сервера 1с - СУБД</span></a></li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">накладных расходов на многопоточность (построение карты порций, слияние результатов и прочее)</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ожиданий между потоками на блокировках данных, поэтому очень желательно использовать режим управляемых блокировок и разделения итогов регистров</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Количества потоков, чем их больше, тем лучше до некоторого порога</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Детально многопоточное ускорение обработки набора объектов можно выразить формулой</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span><img src="data:image/png;base64,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" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">где</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A - ускорение, отношение длительности выполнения однопоточной обработки к длительности выполнения многопоточной обработки</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P - длительность нераспараллеливаемой части вычислений для набора объектов в целом, общей для обоих вариантов обработки</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">например, выполнение сложного запроса для получения ключей объектов набора</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">T - длительность вычислений на один объект в однопоточном режиме</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">M - количество объектов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">G - длительность вычислений для набора объектов в целом, необходимых только для многопоточного варианта обработки</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">например, слияние результатов</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">N - количество потоков</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">E - длительность вычислений для порции объектов, необходимых только для многопоточного варианта обработки</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">например, сохранение результата порции</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">W - степень конкуренции (ожиданий, обусловленных многопоточным режимом), находится в диапазоне [0;1] и во многом зависит от N, основные типы ожиданий:</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">на блокировках данных между потоками</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">на очередях аппаратных ресурсов</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">R - длительность дополнительных вычислений по объекту в многопоточном режиме  (накладные расходы на многопоточность)</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">например, привязка и отвязка объекта от порции</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Влияние накладных расходов по объекту на ускорение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При достаточно большом количестве объектов и отсутствии конкуренции между потоками формула ускорения превращается в</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAAA+CAIAAADLQTJiAAADxUlEQVR4nO2dW5asIAxFGSETYjSMhZE4EvtDW5GHRgglgbO/uu+t1VUm2/Au1ZpHKXXzvwA05U4+qAk+BGqCToGaoFOgZgZn1BPaLl9/ys/Yw2Ncu7eAmmkWq333tkx4iXBmWjP9mxZq/pzFGl+8yMzwBfMRh4QbqJlisdZdftVhGoJXzAfU7IHNzFnb7wxQswecgZkRwtV0ZoSEtk+CRD5R8xh+BT+/xZkhag3MTPJt1axh658NkFF0NNNIVXMXcwA1YWYGmWoeYg6QUjTnGSSquVittR5ETZiZQ56azijjjrUs6TmFmVmkqbmJebTowovmfoMJv4o27CluGRtONXcxzw0AYpOa2HYk9lrYOYcSbUPDp+Yh5lrUnhM2ocWM2dQiFOu6sqm5WH3eO+NMHYEPYVHzIuYwXU3wLQxqBmIO0NUEPVCtZiRmWVezNQW9N3a+jsHO12EIyX7OustMnUMo62o27vuzBrMQhCJJ9nNSL+h9DNGegxoq1PRmi8J/V0r11Z4DeRSrmRMTU0eAhzI1F6uz5mHqCLBQuH39xrsZp46itTtZHe54zMDb4iVOpBJ4raYz9+8yY3u+WP3voH/qZLFaTBAWq4+UsR7TO+/apmqed9dTaz6XnM7+59HPsKiz6s54+Qq+uqSeS1ioENVMTRMFXxkgukljoigFPXAdPDy1jEV/vn2DDvIMYWaLPcJQ84lsaWdKhNTjzUFc+G8uqEkh2p79n5ds5LIzuIkXyjXzOJ1ANYgclhVqEkn08e/bMGoOxJv5TiGoyU1qju3+sDkxB1I7msGkAvkioCYzydlfjqrJPqr9EYE19HkjqMlMwqCn78B5zMF1Zk1Om34Z/XjrBLTreNPPKQrOZGqGCx2UBf835WEimodlLjVTKwehlfnFA4mVkY3fh2UqNS8dTfKeg4fy8Jgw1c3Ri5iKT948LP1GjZ9ARuqXwEHNJFCTj6hMEt1EXzMJ+ppsJESkuQk1k0BNLpIaktwk5CA94+INunp2u3DTWPOwzKJm5sF1jwvoK708ZNaZeh/Nl+6Dbh6W8dWMi8L1qWmadg8T3sdYa6K/3nO9XNe1+T7o8rCMr+aP2J4MeN3iIcHMkyabACrCAjWZ2IuP1LNBrbanVIQFavLgjDeTf3TdBJnZZk9fTVigJgteuI/qI+tZc23NLAkL1OTgMmbYkwAzK8MCNRkIH47ujFJaS3pgesMh0MnLsEDNeuJCIO0sRpN90LVhgZpV5FY2woLRL032QbOEBWqCToGaoFOgJugUqAk6BWqCTvkDoutZdkr48jAAAAAASUVORK5CYII=" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Таким образом оценив R и T, мы можем достаточно неплохо оценить ускорение для многих обработок. Чем меньше будут относительные накладные расходы (R по отношению к T), тем больше будет эффект от увеличения количества потоков.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image3964.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="https://lh6.googleusercontent.com/mBVHnD1gtdiAcL_rCwe8D1xrYIwoAZ3COgXJgyZnnD053UpoeTy45UxWvBa7gMqrEwhhXVZDBZPfs1lCxvcaEc71ch3V8qW07HcK0J-0Excm-J8kbRcsJwnJ9DBfmrW8fYUnkj8" width="-2" height="-2" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Какие выводы можно сделать из графика:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однопоточный режим будет практически всегда быстрее многопоточного с количеством потоков (N) =1, что обусловлено выполнением дополнительных вычислений. Поэтому при N=1 его нужно отключать.</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чем больше потоков, тем сильнее падает ускорение с увеличением накладных расходов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хорошо масштабируемым ускорение можно считать при накладных расходах до 10%</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После 30% многопоточность использовать уже не рационально</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При 50% 2-х поточный режим работает с той же скоростью что и однопоточный</li></ol>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-style:italic; color:#000000; background-color:#000000;">Пример.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Допустим обработка выгрузки и загрузки данных тратит на объект 0.045 сек, а на распределение объекта 0.005 сек. Тогда R/T=0.1, т.е. при 2-х потоках ускорение составит примерно 1.7, а при 3-х потоках - 2.3.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Влияние конкуренции на ускорение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Степень конкуренции является наиболее трудно оцениваемым параметром, т.к. зависит от многих факторов, многие из которых косвенно зависят от количества потоков (N) и могут меняться в процессе обработки. Эти факторы делятся на 2 основных типа: ожидания на очередях аппаратных ресурсов и ожидания на блокировках данных.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Ожидания на блокировках данных возникают уже при 2-х потоках, если потоки вызывают блокировки пересекающихся диапазонов данных. Поэтому для ожиданий на блокировках данных зависимость W(N) относительно слабая, а больше зависимость от конкретных объектов данных.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Влияние аппаратных ресурсов на многопоточное ускорение достаточно слабое пока рост количества потоков не приведет к полной загрузке хотя бы одного из них. Тогда начнутся массовые ожидания потоками на очереди доступа к этому ресурсу (например процессору или диску). Какой это будет ресурс и на каком вычислительном узле, сильно зависит от специфики обработки. Таким образом для аппаратных ресурсов функция W(N) чаще всего растет резко, но при большом N.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">При достаточно большом количестве объектов и отсутствии накладных расходов формула ускорения принимает вид</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="data:image/png;base64,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" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Т.е. превращается в чистый </span><a href="http://infostart.ru/redirect.php?url=aHR0cHM6Ly9ydS53aWtpcGVkaWEub3JnL3dpa2kvJUQwJTk3JUQwJUIwJUQwJUJBJUQwJUJFJUQwJUJEXyVEMCU5MCVEMCVCQyVEMCVCNCVEMCVCMCVEMCVCQiVEMCVCMA=="><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">закон Амдала</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">, где W по сути описывает долю нераспараллеливаемых вычислений в каждом потоке.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image18521.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="https://lh5.googleusercontent.com/0-9byt-uN9dIXAOW9_Odvj1BJM2Q19vkRukstoRn_Yg7XgUXGCi6tREmRwE6iKpXZaZV0w9YWkUOEfR1pmhPIJTqoZ3U06hPJGsLclls6j1uBnXp19CHJtfQrv8hQ85-73KLj2c" width="-2" height="-2" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">График похож на предыдущую зависимость, но здесь он более пологий.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Влияние количества потоков на ускорение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Теперь посмотрим как будет зависеть ускорение от количества потоков при достаточно большом количестве объектов и реалистичных W и R/T.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="data:image/png;base64,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" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="https://lh4.googleusercontent.com/i9usARXcQ4ewYWToAxoYTi8RXJCNEjFxuTXKJhJfbhoJT8CTS9t60l3GGOHUDVQeI8qOlOlOaEOdG1oMflZvsITxGrC4kGqhfQJCMYAGv7syS_LGOFZpKPLynsm9sVtB45OGSIYu" width="-2" height="-2" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="https://lh4.googleusercontent.com/G6gQv9eV6dYoVodjxL2EU8LzR7ssBvEiNwGZa7v2b_gMAfXQk4xZT_89OrMyw8dj_fPlZK_e7Na1X2X16BOZPaCaPnI1OAZwmI0qkg2prWUjJZHTXXYkV7jkubBUrkKKD6PZyRWJ" width="-2" height="-2" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image32656.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Calibri'; color:#000000; vertical-align:middle;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">На этих графиках хорошо видно, что многопоточное ускорение при наличии даже небольших относительных накладных расходов на объект быстро замедляет рост с увеличением числа потоков. Поэтому не стоит без большой необходимости сразу включать много потоков обработке, даже если позволяют аппаратные ресурсы, т.к. эффективность использования этих ресурсов может быть низкой. В большинстве случаев лучше начать с 2-4 потоков, выполнить обработку с тестовым большим набором данных, увеличить количество потоков на 1, повторить тест. Если разница будет заметной (более 20%), то можно добавить еще один поток и повторить эксперимент. Если разница будет незаметной (менее 20%), то лучше остановиться на предыдущем значении.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:medium; font-weight:600; color:#000000; background-color:#000000;">Оценка степени конкуренции</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Одним из способов оценки W является вычисление ее значения через известные значения остальных переменных формулы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK8AAAA5CAIAAADPz+x8AAAD90lEQVR4nO2c2aGEIAxFqZCGqIZaqMRKnA9FtgQIi4ya+/mcFzAcQwyI2FksK7G6A8/TpqUQQpmRNo0SkcbarxTTQNJBwpTR2rS8rBolhJB6G9xEUUwDXf64jZNRntFNyxU4MA10TaFh09KzadSSyYJpoGsGDT4MRxKxInFgGjBtWiKhegINLh/BkhK8OwP1Whr8LD12Y+T71Mv58R5Pw2UxZ3pULnF6BmrltTScOm4d8iHq+E3LvNOH0+AZLNg2qgsI/xH5IA3X7af3bhQKScHfo2kI7JWMD2gcz0veTcOmpdQGrBbBMFSwMJyGyFxxQqjqY04fpeHMvI40IXQgDEM5EAdFw+5JPEhgrLXrj5j5Xhq/ScOVhqc44DCsKQnT1Fmq/CYNRoWv8M5/8OvaqnowWZ0rJZ+kwYMh8kBY97Mq+zheWfLU3MuMTdxyX33qizREz78/1gEnl8qhoWLMolJGosR+Ew3+zZBb/CINyWTgkgcYBqbhvTQAmYHFQcOFhoXLA2T1JQ7fowF8/u3rIRwAZuximSTOG0jKTQbobNDyTrFp1fkSgkd6vCt9r8IFGtAOKQPs0Qr7Cv3v6ucLr9bl63hkJwc7VNrk9civfW1a4ob71q/OEYP+XyS/AsfTu4bUc0s436PiynDWy8RFoSH1CaOtgWi5QudhaIIweXSj3gvot9Ad2hgB9uJBU25e9Y7etFS6d8WgqenudQpcIA3wZgv84R8QMP9Gdb4+0oWR910Nw0xn+zTgKXd2KngTC/teMy5GHW4Yeed1k9TEuLDvMA2ZpCG9+bexsO97IU0bu4zpGS3Z6tzqUiEoi4wG1yi7RyDtzCtZOGUjQCA/Cx148+WBvntfJJwaHD6BJ5E3swAqqC4M3PQy5wsNujwaoBE/qzhg2GhmAS1h5LTeV/GeiHGB+2/2VTgagBG/wiIQNj4VFxy/XqFoSOoQPhmryzUpDdKrhoTfe3jXPsXCd+RoiEbcT5fisMEsvFTpwrzdECKjfOkC5d9ZaEhKWKfrrA8DGqKXKz9sDGBhchY5zENfUkSDN+LJi7YrS/17XGB1ydLgQoNOVuyviUL+x1sxa5YSGpDiM3aN9SZZGjIfLGavsd6kiAbsm2VmIVDXcQCkJu51+klDbrvKg/YS36yG4wDqza4Ix8J1ILeCyywAoh8HQLe+iAa087cspT5R5OMAaFpIA4ss8nEARDENDxL5OACqmIYHiXocQEsDTMNDRD0OoKkFpuEZIh8HQBfT8BTRjwMY+V39PDENDWo4DoBpeK0ajgNoaoRpeICajgNoaYVp+Hu1HgfQ0MxIuKrENNSr8ziA1nZuRIJpYDkxDSwnpoHlxDSwnH7KhE6n4Fd+8wAAAABJRU5ErkJggg==" style="vertical-align: middle;" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Пример.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Если мы получили ускорение 2.7 для 10 потоков и относительных накладных расходах 0.1, то по этой формуле мы получим достаточно высокую степень конкуренции 0.2. Если при этом показатели очередей аппаратных ресурсов не зафиксировали значительных ожиданий, то скорее всего она обусловлена ожиданиями на блокировках данных.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Параметры многопоточности для каждой обработки</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Минимальное количество объектов на порцию</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Позволяет снизить вероятность запусков, в которых многопоточный режим будет проигрывать однопоточному из-за дополнительных вычислений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При количестве порций 1 многопоточный режим отключается</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Количество потоков</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используется при построении карты порций, чтобы ограничить максимальное количество порций в ней</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используется диспетчером при решении «запускать ли новый поток для обработки?», поэтому оператор может менять его в любой момент</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Фактическое количество потоков всегда меньше или равно количеству порций</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Надежность</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Транзакции и блокировки данных для изменяющих БД обработок</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Каждый объект обрабатываем в отдельной транзакции</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Исключительно блокируем объект перед чтением, чтобы избежать его считывания для записи в другом сеансе</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Особенно актуально для многопоточных обработок с возможностью пересечения потоков по изменяемым данным. Примеры</li></ol>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Замена ссылок</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем в нерабочее (для пользователей) время</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таким образом снижаем вероятность возникновения ошибок взаимоблокировок и превышения ожидания блокировок</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Повтор обработки объекта при ошибке</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Эффективен только при определенных типах ошибок</li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Взаимоблокировки – высокая вероятность исправления</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Превышения ожидания блокировки – низкая вероятность исправления</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ограничиваем количество попыток и их общую длительность</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Повтор обработки в целом при ошибке</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обходим все остальные плавающие ошибки</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При возможности используем запись объектов в режиме ОбменДанными.Загрузка</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно выполняется очень незначительный процент кода обработчиков событий записи и поэтому меньше вероятность ошибок прикладного кода</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Платформа отключает ряд своих механизмов, но это не только приводит к обходу одних проблем, но и иногда к появлению других. Например для регистра бухгалтерии есть особенности, которые обязательно нужно учитывать в этом режиме.</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При возможности выполняем полную очистку программного кода</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выше мы уже рассмотрели этот прием в плане повышения производительности. Для многих больших многолетних систем проконтролировать все критерии качества написания прикладного программного кода очень трудоемко. В них например могут быть различные прикладные проверки перед записью объектов случайно или даже намеренно не заключенные в условие “Если Не ЭтотОбъект.ОбменДанными.Загрузка” и тому подобные. Устранение всех возможных ошибок прикладного кода может занять время, не соразмерное с выделяемым на поставленную задачу. Временная очистка программного кода позволяет нейтрализовать сразу все такие ошибки.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Гибкость</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Пропуск ошибочных объектов для повторной обработки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Многие обработки не чувствительны к порядку обработки объектов. Поэтому в случае возникновения ошибки обработки любого объекта его можно отложить на следующий сеанс.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Такие обработки по способу передачи информации о пропущенных объектах между сеансами можно разделить на 2 типа:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Естественная передача. Не требует дополнительных действий. Примеры:</li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запрос с отбором по условию, изменяемому при обработке объекта</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выборка изменений по узлу со снятием регистрации после успешной обработки объекта</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Явная передача. Здесь требуется строгая и желательно компактная идентификация объектов. Примеры:</li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выборка изменений по узлу с перерегистрацией пропускаемых объектов и снятием регистрации по номеру выбранного сообщения после обхода всех объектов</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обмен данными, пропущенные при загрузке объекты передаем на сторону выгрузки в виде ключей и там заново регистрируем для отправки</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Управляем нагрузкой на оборудование</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Думаю многие сталкивались с пиками нагрузки, вызванными неожиданным запуском сразу большого числа регламентных заданий, которые иногда даже приводят к зависанию менеджера кластера. Также те, кто работает с многопоточностью скорее всего знакомы с пиками нагрузки, вызванными сбоями в работе многопоточной логики. Чтобы ограничить такие пики можно ввести понятие несущего сеанса (в нашем продукте “процессор автозаданий”), т.е. такого сеанса, который служит ячейкой для размещения конкретной обработки. Оператор константой задает количество таких несущих сеансов для базы и таким образом ограничивает количество одновременно выполняющихся (потоков) обработок. Практика показывает, что количество несущих сеансов оптимально устанавливать  в пределах [N;2N], где N - среднее между количеством логических ядер на серверах 1С и СУБД. Но такое ограничение может быть не всегда удобно и в каких то сценариях, например для строгого соблюдения расписания, потребуются обычные (выделенные) сеансы. Поэтому оптимальным решением будет применять комбинированный режим:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для каждой обработки указываем режим запуска несущий/выделенный сеанс</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для требовательных к расписанию обработок устанавливаем режим “выделенный сеанс” (регламентное задание), жертвуя управляемостью нагрузки</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для остальных используем несущий сеанс, жертвуя строгостью соблюдения регламента запуска</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Диспетчер создает N регламентных заданий (несущих), которые будут захватывать и запускать из очереди задания-обработки с режимом “выделенный сеанс” в соответствии с их расписанием и многопоточностью</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Диспетчер завершает обработки в запрещенное регламентом время</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Чем меньше баз с таким механизмом на одном серверном компьютере, тем выше управляемость нагрузкой.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Мониторинг</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В случае нештатной ситуации с выполнением обработки ответственного спросят о причине, по которой она произошла. Чтобы облегчить задачу поиска этой причины полезно регистрировать ряд событий и состояний для каждой обработки</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Каждый сеанс обработки регистрируем в журнале выполнения вместе с</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Начало/Конец/Длительность</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Успешность</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сообщения пользователю, выведенные в процессе обработки. Получить их можно функцией ПолучитьСообщенияПользователю().</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание перехваченной ошибки. Чтобы перехватить ошибку, запускаем обработку внутри Попытка-Исключение.</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание ошибки, которую не удалось перехватить, или аварийное завершение. Это информацию должен собирать диспетчер через штатный журнал фоновых заданий.</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ошибочные объекты регистрируем</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">с подсчетом попыток обработки</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">с датой и описанием первой и последней ошибок</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">после успешной обработки перемещаем в отдельный журнал</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Длительные обработки на каждом этапе должны регулярно обновлять текущий прогресс в специальном регистре состояний</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для статических наборов точно</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для динамических наборов приблизительно, опираясь на размер набора на старте</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Показатели</li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Количество объектов Обработано/Всего/Пропущено/Осталось</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Время Начало/Прошло/Всего приблизительно/Осталось приблизительно</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Средняя длительность обработки объекта</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Необходимо выполнять это не чаще заданного порога, чтобы выполнение этих вспомогательных операций заняло незначительную часть общего времени выполнения обработки</li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы используем порог раз в 10 сек для локальных процессов</li></ul>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При необходимости периодически собираем и регистрируем другие контрольные показатели. Примеры:</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Количество объектов на узле плана обмена</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нагрузка на процессор на локальном компьютере</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Длина очереди диска на сервере СУБД</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Свободное место на системном диске локального компьютера</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Автообрезание журналов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Мощная система мониторинга может вызывать активный рост таблиц журналов, поэтому ей необходим механизм их автообрезания</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В константе храним общую глубину по умолчанию в днях для всех обработок</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для каждой обработки обеспечиваем возможность указания собственной глубины в днях и количестве строк</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выполняем автообрезание в периоды наименьшей нагрузки. Обычно достаточно раз в сутки в ночное время.</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Инструмент отображения мониторинга</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Такой инструмент должен позволять видеть в одном месте все обработки со всей оперативной информацией и журналами.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Оповещения</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">По условию создания оповещения можно разбить на 2 типа: по событиям и по состояниям (интервалам времени).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">По важности оповещения можно разбить на обычные (информационные) и тревожные. Тревожность означает значительную вероятность наличия проблемы, которая не исправится без вмешательства одного из оповещаемых.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Информационные оповещения</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Примером события и одновременно состояния для таких оповещений может служить начало/конец сеанса обработки. Применяются такие оповещения для избранных редко выполняющихся обработок, иначе они будут создавать слишком большой поток малополезных сигналов в приемнике оповещений.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Оповещения по тревожным состояниям</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Создавать оповещения по каждому тревожному событию (например ошибке) у часто выполняющихся обработок явно избыточно, т.к. тревожные события обычно повторяются и потому приемник оповещений быстро засорится и станет мало полезным. Поэтому эффективно объединять тревожные события в тревожные состояния - непрерывные интервалы времени, в течение которых выполняется какое то тревожное условие.</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создаем оповещение когда?</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При регистрации тревожного состояния (тревожное условие изменило результат на Истина)</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В конце тревожного состояния (тревожное условие изменило результат на Ложь)</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В рабочее время каждые N часов агрегировано активные тревожные состояния</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пустое оповещение все равно отправляем, чтобы оповещаемый точно знал, что проблем нет</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Виды тревожных состояний</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Серия неуспехов </span>обработки в целом. Количество последних неуспешных целых сеансов достигло порога</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Фиксируем даты и описания первой и последней ошибок серии</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Серия ошибочных объектов</span>. Имеется хотя бы один ошибочный объект, количество повторов обработки которого превысило порог</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ответственный должен обеспечивать минимальное количество пропускаемых повторно объектов, чтобы удерживать низкий уровень бесполезных вычислений</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Фиксируем информацию свернуто по типам объектов</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Долгий сеанс</span>. Длительность текущего сеанса превысила порог</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Возможные причины</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Зависания</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Бесконечные циклы</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Фиксируем текущий прогресс и дату последней активности</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Пауза обмена данными</span> при приеме сообщений. Завершений загрузки сообщений обмена данными не происходило дольше порога</li></ol>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Серии неуспехов может не быть, т.к. ошибка может быть на стороне отправителя.</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; font-weight:600; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Серия тревожных результатов</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Свертка последних результатов показателя попала в тревожную зону</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:large; font-weight:600; color:#000000; background-color:#000000;">Отправка оповещений</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Отправляем кому?</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Тревожные оповещения отправляем администратору базы и ответственному за конкретную обработку</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Информационные и тревожные оповещения отправляем по списку получателей для конкретной обработки</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Отправляем каким сервисом?</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">email - основное средство доставки оповещений</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">бесплатный</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">допускает относительно большую частоту и объем</li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">отправляем все оповещения в подробном виде</li></ul>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">sms - для особо важных оповещений</li></ol>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">платный</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">допускает относительно малую частоту и объем</li></ul>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 4;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">отправляем только самые важные оповещения и в сокращенном виде</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; color:#000000; background-color:#000000;">Метаданные однотипных обработок для разных баз</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Если у Вас много баз, в которых нужно выполнять однотипные обработки (в частности регламентные задания) с общим вспомогательным кодом, то логично будет собрать все это в независимую подсистему. Примером такой подсистемы может служить БСП (Библиотека Стандартных Подсистем) от 1С. Далее, Вы неизбежно столкнетесь с проблемой актуализации этой подсистемы во всех базах. Чем больше конфигураций и баз, тем больше времени и затрат будет уходить на каждую актуализацию. И тем больше рисков, потерь и убытков для компании - владельца данной инфраструктуры.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Arial,Helvetica,sans-serif'; color:#333333;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Избавиться от этих проблем поможет вынесение подсистемы во внешнюю (управляющую) базу. Что это даст?</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нет необходимости каждый раз обновлять подсистему внутри каждой базы</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нет необходимости подключаться к каждой базе (и переключаться между ними) для управления и обзора общей картины</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проще применять прием полной очистки программного кода</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно комбинировать настройки обработок с базами</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обработки без ссылок на объекты во входных параметрах. Примеры:</li>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Проведение документов за период</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Удаление помеченных объектов</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обработки со ссылками в параметрах на общие объекты для группы баз. Примеры:</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 3;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объединение дублей в базах, получающих нормативно-справочную информацию из единого источника</li></ol>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно организовывать наглядное последовательное (пакетное) выполнение обработок адресованных разным базам, например:</li></ol>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выгрузка данных из базы “Управление торговлей”</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загрузка данных в базу “Бухгалтерия предприятия”</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выгрузка данных из базы “Бухгалтерия предприятия”</li>
<li style=" font-family:'Calibri'; color:#000000; background-color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Загрузка данных в базу “Консолидация”<br /><br /></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">Наш продукт </span><a href="http://infostart.ru/public/145983/"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">2iS:Интеграция</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;"> является примером такой управляющей базы с широкими сервисными возможностями, включающими множество предопределенных обработок и возможность удобной разработки собственных обработок.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:xx-large; font-weight:600; color:#000000; background-color:#000000;">Заключение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">В том или ином виде, большинство из описанных приемов реализованы в нашем продукте</span><a href="http://infostart.ru/public/145983/"><span style=" font-family:'Calibri'; text-decoration: underline; color:#1155cc; background-color:#000000;">2iS:Интеграция</span></a><span style=" font-family:'Calibri'; color:#000000; background-color:#000000;">, в частности, в механизмах обмена данными, объединения дублей и универсальной обработки объектов. Все они используются в реальных рабочих процессах в крупных компаниях с большими объемами данных и позволяют фактически одному сотруднику обеспечивать эффективную работу всех обработок в большом количестве баз. Несмотря на наличие в конфигурации защищенного модуля, 99% программного кода конфигурации открыто, то есть Вы можете изучить реализацию описанных приемов</span></p></body></html>